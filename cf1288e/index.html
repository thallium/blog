<!doctype html><html lang=en><head><meta charset=utf-8><title>Tutorial for Codeforces 1288E - Messenger Simulator</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.tgc-thallium.com/index.xml title="Thallium's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorial for Codeforces 1288E - Messenger Simulator"><meta name=twitter:description content><link rel=stylesheet href=https://blog.tgc-thallium.com/fontawesome/css/all.min.css><link rel=stylesheet href=https://blog.tgc-thallium.com/css/main.css><link id=dark-mode-theme rel=stylesheet href=https://blog.tgc-thallium.com/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.tgc-thallium.com/js/main.bundle.js></script><script src=https://blog.tgc-thallium.com/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.83.1"></head><body><header><nav class=navbar><div class=nav><p class=nav-logo>Lang:</p><ul class=nav-links><li><a href=/ id=Home title=Home><em class="fas fa-home fa-lg"></em></a></li><li><a href=/about/ id=About title=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags/ id=Tags title=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/categories/ id=Categories title=Categories><em class="fas fa-list fa-lg"></em></a></li><li><a href=/archives/ id=Archives title=Archives><em class="fas fa-archive fa-lg"></em></a></li><li><a href=/search/ id=Search title=Search><em class="fas fa-search fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>Tutorial for Codeforces 1288E - Messenger Simulator</h1><span class=meta-post><em class="fa fa-calendar-alt"></em>&nbsp;May 9, 2020
&nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
<a href=https://blog.tgc-thallium.com/categories/solutions/>Solutions</a>&nbsp;</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css integrity=sha384-L+Gq2Cso/Y2x8fX4wausgiZT8z0QPZz7OqPuz4YqAycQJyrJT9NRLpjFBD6zlOia crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.js integrity=sha384-z64WtjpyrKFsxox9eI4SI8eM9toXdoYeWb5Qh+8PO+eG54Bv9BZqf9xNhlcLf/sA crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!0}],throwOnError:!1})})</script><h2 id=tutorial>Tutorial</h2><p>A faster way to simulate the process is that instead of moving the hole array, we can add some extra space in front of the array and simply move the element to the extra space. For example, in the sample input:</p><pre><code>5 4
3 5 1 4
</code></pre><p>The process would look like</p><pre><code>_ _ _ _ 1 2 3 4 5
_ _ _ 3 1 2 _ 4 5
_ _ 5 3 1 2 _ 4 _
_ 1 5 3 _ 2 _ 4 _
4 1 5 3 _ 2 _ _ _
</code></pre><p>We can use a fenwick tree to simulate the process: mark a position with 1 if it&rsquo;s occupied by some number and the prefix sum is how many elements is in front of it (i.e. the real position in the simulator). In the end, don&rsquo;t forget to update the position of all the elements in case some are not moved.</p><h2 id=code>Code</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;bits/stdc++.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#define forn(i, n) for (int i = 0; i &lt; int(n); ++i)
</span><span style=color:#75715e>#define for1(i, n) for (int i = 1; i &lt;= int(n); ++i)
</span><span style=color:#75715e>#define ms(a, x) memset(a, x, sizeof(a))
</span><span style=color:#75715e>#define F first
</span><span style=color:#75715e>#define S second
</span><span style=color:#75715e>#define all(x) (x).begin(),(x).end()
</span><span style=color:#75715e>#define pb push_back
</span><span style=color:#75715e></span>
<span style=color:#00a8c8>using</span> <span style=color:#00a8c8>namespace</span> <span style=color:#111>std</span><span style=color:#111>;</span>
<span style=color:#00a8c8>typedef</span> <span style=color:#00a8c8>long</span> <span style=color:#00a8c8>long</span> <span style=color:#111>ll</span><span style=color:#111>;</span>
<span style=color:#00a8c8>typedef</span> <span style=color:#111>pair</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>pii</span><span style=color:#111>;</span>
<span style=color:#00a8c8>const</span> <span style=color:#00a8c8>int</span> <span style=color:#111>INF</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x3f3f3f3f</span><span style=color:#111>;</span>
<span style=color:#111>mt19937</span> <span style=color:#75af00>gen</span><span style=color:#111>(</span><span style=color:#111>chrono</span><span style=color:#f92672>::</span><span style=color:#111>steady_clock</span><span style=color:#f92672>::</span><span style=color:#111>now</span><span style=color:#111>().</span><span style=color:#111>time_since_epoch</span><span style=color:#111>().</span><span style=color:#111>count</span><span style=color:#111>());</span>
<span style=color:#00a8c8>template</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>typename</span><span style=color:#111>...</span> <span style=color:#111>Args</span><span style=color:#f92672>&gt;</span> <span style=color:#00a8c8>void</span> <span style=color:#111>rd</span><span style=color:#111>(</span><span style=color:#111>Args</span><span style=color:#f92672>&amp;</span><span style=color:#111>...</span> <span style=color:#111>args</span><span style=color:#111>)</span> <span style=color:#111>{((</span><span style=color:#111>cin</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>args</span><span style=color:#111>),</span> <span style=color:#111>...);}</span>
<span style=color:#00a8c8>template</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>typename</span><span style=color:#111>...</span> <span style=color:#111>Args</span><span style=color:#f92672>&gt;</span> <span style=color:#00a8c8>void</span> <span style=color:#111>wr</span><span style=color:#111>(</span><span style=color:#111>Args</span><span style=color:#111>...</span> <span style=color:#111>args</span><span style=color:#111>)</span> <span style=color:#111>{</span> <span style=color:#111>((</span><span style=color:#111>cout</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#111>args</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#d88200>&#34; &#34;</span><span style=color:#111>),</span> <span style=color:#111>...);</span> <span style=color:#111>cout</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#111>endl</span><span style=color:#111>;}</span>

<span style=color:#00a8c8>struct</span> <span style=color:#75af00>fenwick</span><span style=color:#111>{</span>
    <span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>;</span>
    <span style=color:#111>vector</span><span style=color:#f92672>&lt;</span><span style=color:#111>ll</span><span style=color:#f92672>&gt;</span> <span style=color:#111>t</span><span style=color:#111>;</span>
    <span style=color:#111>fenwick</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>n_</span><span style=color:#111>)</span><span style=color:#f92672>:</span><span style=color:#111>n</span><span style=color:#111>(</span><span style=color:#111>n_</span><span style=color:#111>),</span><span style=color:#111>t</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>){}</span>
    <span style=color:#00a8c8>void</span> <span style=color:#75af00>add</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#00a8c8>int</span> <span style=color:#111>x</span><span style=color:#111>){</span>
        <span style=color:#00a8c8>for</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>&lt;=</span><span style=color:#111>n</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>+=</span><span style=color:#111>i</span><span style=color:#f92672>&amp;-</span><span style=color:#111>i</span><span style=color:#111>){</span>
            <span style=color:#111>t</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>+=</span><span style=color:#111>x</span><span style=color:#111>;</span>
        <span style=color:#111>}</span>
    <span style=color:#111>}</span>
    <span style=color:#00a8c8>int</span> <span style=color:#75af00>query</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>){</span>
        <span style=color:#111>ll</span> <span style=color:#111>res</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span>
        <span style=color:#00a8c8>for</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>-=</span><span style=color:#111>i</span><span style=color:#f92672>&amp;-</span><span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>res</span><span style=color:#f92672>+=</span><span style=color:#111>t</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>res</span><span style=color:#111>;</span>
    <span style=color:#111>}</span>
    <span style=color:#00a8c8>int</span> <span style=color:#75af00>query</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>l</span><span style=color:#111>,</span><span style=color:#00a8c8>int</span> <span style=color:#111>r</span><span style=color:#111>){</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>r</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>l</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#111>}</span>
<span style=color:#111>};</span>
<span style=color:#00a8c8>int</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
    <span style=color:#111>ios</span><span style=color:#f92672>::</span><span style=color:#111>sync_with_stdio</span><span style=color:#111>(</span><span style=color:#111>false</span><span style=color:#111>);</span>
    <span style=color:#111>cin</span><span style=color:#111>.</span><span style=color:#111>tie</span><span style=color:#111>(</span><span style=color:#00a8c8>nullptr</span><span style=color:#111>);</span>
    <span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>,</span><span style=color:#111>m</span><span style=color:#111>;</span>
    <span style=color:#111>cin</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>n</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>m</span><span style=color:#111>;</span>
    <span style=color:#111>vector</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>l</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>),</span><span style=color:#111>r</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>);</span>
    <span style=color:#111>iota</span><span style=color:#111>(</span><span style=color:#111>all</span><span style=color:#111>(</span><span style=color:#111>l</span><span style=color:#111>),</span><span style=color:#ae81ff>0</span><span style=color:#111>);</span>
    <span style=color:#111>r</span><span style=color:#f92672>=</span><span style=color:#111>l</span><span style=color:#111>;</span>
    <span style=color:#111>vector</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>pos</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>);</span>
    <span style=color:#111>forn</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>)</span> <span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>=</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>m</span><span style=color:#111>;</span>
    <span style=color:#111>fenwick</span> <span style=color:#111>tree</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#f92672>+</span><span style=color:#111>m</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#111>forn</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>)</span> <span style=color:#111>tree</span><span style=color:#111>.</span><span style=color:#111>add</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>m</span><span style=color:#111>,</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#111>forn</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>m</span><span style=color:#111>){</span>
        <span style=color:#00a8c8>int</span> <span style=color:#111>x</span><span style=color:#111>;</span>
        <span style=color:#111>cin</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>x</span><span style=color:#111>;</span>
        <span style=color:#111>x</span><span style=color:#f92672>--</span><span style=color:#111>;</span>
        <span style=color:#111>l</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>]</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span>
        <span style=color:#111>r</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>]</span><span style=color:#f92672>=</span><span style=color:#111>max</span><span style=color:#111>(</span><span style=color:#111>r</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>],</span><span style=color:#111>tree</span><span style=color:#111>.</span><span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>));</span>
        <span style=color:#111>tree</span><span style=color:#111>.</span><span style=color:#111>add</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>],</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
        <span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>]</span><span style=color:#f92672>=</span><span style=color:#111>m</span><span style=color:#f92672>-</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>;</span>
        <span style=color:#111>tree</span><span style=color:#111>.</span><span style=color:#111>add</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>x</span><span style=color:#111>],</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#111>}</span>
    <span style=color:#111>forn</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>)</span> <span style=color:#111>r</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>=</span><span style=color:#111>max</span><span style=color:#111>(</span><span style=color:#111>r</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>],</span><span style=color:#111>tree</span><span style=color:#111>.</span><span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>pos</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>));</span>
    <span style=color:#111>forn</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>)</span> <span style=color:#111>wr</span><span style=color:#111>(</span><span style=color:#111>l</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span><span style=color:#111>r</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#00a8c8>return</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
<span style=color:#111>}</span>
</code></pre></div><div class=blog-tags><a href=https://blog.tgc-thallium.com/tags/data-structure/>Data Structure</a>&nbsp;
<a href=https://blog.tgc-thallium.com/tags/fenwick-tree/>Fenwick Tree</a>&nbsp;</div></article></div><footer><div class=social-icons><a href=https://github.com/thallium name=GitHub><em class="fab fa-github"></em></a></div><div class=container><p class="credits copyright"><a href=https://blog.tgc-thallium.com/about>Gengchen</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.tgc-thallium.com/>Thallium's Blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>