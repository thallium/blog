<!doctype html><html lang=en><head><meta charset=utf-8><title>Tutorial for Codeforces 1268C/1269E</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.tgc-thallium.com/index.xml title="Thallium's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorial for Codeforces 1268C/1269E"><meta name=twitter:description content><link rel=stylesheet href=https://blog.tgc-thallium.com/fontawesome/css/all.min.css><link rel=stylesheet href=https://blog.tgc-thallium.com/css/main.css><link id=dark-mode-theme rel=stylesheet href=https://blog.tgc-thallium.com/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.tgc-thallium.com/js/main.bundle.js></script><script src=https://blog.tgc-thallium.com/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.83.1"></head><body><header><nav class=navbar><div class=nav><p class=lang><i class="fas fa-globe"></i>
<a href=https://blog.tgc-thallium.com/zh-hans/ title="no translation">中文</a></p><ul class=nav-links><li><a href=/ id=Home title=Home><em class="fas fa-home fa-lg"></em></a></li><li><a href=/about/ id=About title=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags/ id=Tags title=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/categories/ id=Categories title=Categories><em class="fas fa-list fa-lg"></em></a></li><li><a href=/archives/ id=Archives title=Archives><em class="fas fa-archive fa-lg"></em></a></li><li><a href=/search/ id=Search title=Search><em class="fas fa-search fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>Tutorial for Codeforces 1268C/1269E</h1><span class=meta-post><em class="fa fa-calendar-alt"></em>&nbsp;May 21, 2020
&nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
<a href=https://blog.tgc-thallium.com/categories/solutions/>Solutions</a>&nbsp;</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css integrity=sha384-L+Gq2Cso/Y2x8fX4wausgiZT8z0QPZz7OqPuz4YqAycQJyrJT9NRLpjFBD6zlOia crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.js integrity=sha384-z64WtjpyrKFsxox9eI4SI8eM9toXdoYeWb5Qh+8PO+eG54Bv9BZqf9xNhlcLf/sA crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!0}],throwOnError:!1})})</script><h2 id=solution>Solution</h2><p>Forming a subsegment of $1,2,3,\dots,k$ consists two steps:</p><ol><li><p>Make numbers $1,2,3,\dots,k$ form a subsegment in any order.</p></li><li><p>Change the order of numbers to form $1,2,3,\dots,k$.</p></li></ol><p>The first step reminds us a classic problem: moving some points to one points with the minimum moves. The optimal way is to move all the points to the points in the middle. Let the coordinate of the points be $p_i$ and the point in the middle be $mid$, the answer is $\sum\vert mid-pos_i\vert $. However, in the actual problem we don&rsquo;t move all the points to form a segment rather than a point and it&rsquo;s quite easy to fix: suppose there are $front$ points in front of the middle point and $back$ points in the back of middle point. Now the answer should be
$$\sum\vert mid-pos_i\vert -\dfrac {(1+front)\cdot front} 2-\dfrac {(1+back)\cdot back} 2$$</p><p>The answer for the second part is quite obvious: it&rsquo;s the number of <a href=https://en.wikipedia.org/wiki/Inversion_(discrete_mathematics)>inversion</a>.</p><p>In the fist part, note that
$$\begin{align*}&\sum\vert mid-pos_i\vert \\ =&\sum\limits _{pos_i&lt; mid}(mid-pos_i)+\sum\limits _{pos_i> mid}(pos_i-mid)\\ =&front\cdot mid-\sum\limits _{pos_i&lt; mid} pos_i+\sum\limits _{pos_i>mid}pos_i-mid\cdot back\end{align*}$$</p><p>We can use a fenwick tree to find the answer: for each i add $pos_i$ to $pos_i$ and use range-query to find $\sum\limits_{pos_i&lt; mid} pos_i$ and $\sum\limits_{pos_i>mid}pos_i$.</p><p>To track the number of inversion, we can use a fenwick tree, but I choose a ordered set in the pb_ds library since it can also find the position of the middle point.</p><h2 id=code>Code</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;bits/stdc++.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ext/pb_ds/assoc_container.hpp&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ext/pb_ds/tree_policy.hpp&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span><span style=color:#75715e>&lt;ext/pb_ds/priority_queue.hpp&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#00a8c8>using</span> <span style=color:#00a8c8>namespace</span> <span style=color:#111>__gnu_pbds</span><span style=color:#111>;</span>
<span style=color:#75715e>#define forn(i, n) for (int i = 0; i &lt; int(n); ++i)
</span><span style=color:#75715e>#define for1(i, n) for (int i = 1; i &lt;= int(n); ++i)
</span><span style=color:#75715e>#define ms(a, x) memset(a, x, sizeof(a))
</span><span style=color:#75715e>#define F first
</span><span style=color:#75715e>#define S second
</span><span style=color:#75715e>#define all(x) (x).begin(),(x).end()
</span><span style=color:#75715e>#define pb push_back
</span><span style=color:#75715e></span>
<span style=color:#00a8c8>using</span> <span style=color:#00a8c8>namespace</span> <span style=color:#111>std</span><span style=color:#111>;</span>
<span style=color:#00a8c8>typedef</span> <span style=color:#00a8c8>long</span> <span style=color:#00a8c8>long</span> <span style=color:#111>ll</span><span style=color:#111>;</span>
<span style=color:#00a8c8>typedef</span> <span style=color:#111>pair</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>pii</span><span style=color:#111>;</span>
<span style=color:#00a8c8>const</span> <span style=color:#00a8c8>int</span> <span style=color:#111>INF</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x3f3f3f3f</span><span style=color:#111>;</span>
<span style=color:#111>mt19937</span> <span style=color:#75af00>gen</span><span style=color:#111>(</span><span style=color:#111>chrono</span><span style=color:#f92672>::</span><span style=color:#111>steady_clock</span><span style=color:#f92672>::</span><span style=color:#111>now</span><span style=color:#111>().</span><span style=color:#111>time_since_epoch</span><span style=color:#111>().</span><span style=color:#111>count</span><span style=color:#111>());</span>
<span style=color:#00a8c8>template</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>typename</span><span style=color:#111>...</span> <span style=color:#111>T</span><span style=color:#f92672>&gt;</span> <span style=color:#00a8c8>void</span> <span style=color:#111>rd</span><span style=color:#111>(</span><span style=color:#111>T</span><span style=color:#f92672>&amp;</span><span style=color:#111>...</span> <span style=color:#111>args</span><span style=color:#111>)</span> <span style=color:#111>{((</span><span style=color:#111>cin</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>args</span><span style=color:#111>),</span> <span style=color:#111>...);}</span>
<span style=color:#00a8c8>template</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>typename</span><span style=color:#111>...</span> <span style=color:#111>T</span><span style=color:#f92672>&gt;</span> <span style=color:#00a8c8>void</span> <span style=color:#111>wr</span><span style=color:#111>(</span><span style=color:#111>T</span><span style=color:#111>...</span> <span style=color:#111>args</span><span style=color:#111>)</span> <span style=color:#111>{((</span><span style=color:#111>cout</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#111>args</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#d88200>&#34; &#34;</span><span style=color:#111>),</span> <span style=color:#111>...);</span><span style=color:#111>cout</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#111>endl</span><span style=color:#111>;}</span>

<span style=color:#00a8c8>template</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>typename</span> <span style=color:#111>T</span><span style=color:#f92672>&gt;</span>
<span style=color:#00a8c8>using</span> <span style=color:#111>ordered_set</span> <span style=color:#f92672>=</span> <span style=color:#111>tree</span><span style=color:#f92672>&lt;</span><span style=color:#111>T</span><span style=color:#111>,</span> <span style=color:#111>null_type</span><span style=color:#111>,</span> <span style=color:#111>less</span><span style=color:#f92672>&lt;</span><span style=color:#111>T</span><span style=color:#f92672>&gt;</span><span style=color:#111>,</span> <span style=color:#111>rb_tree_tag</span><span style=color:#111>,</span> <span style=color:#111>tree_order_statistics_node_update</span><span style=color:#f92672>&gt;</span><span style=color:#111>;</span>

<span style=color:#00a8c8>struct</span> <span style=color:#75af00>fenwick</span><span style=color:#111>{</span>
    <span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>;</span>
    <span style=color:#111>vector</span><span style=color:#f92672>&lt;</span><span style=color:#111>ll</span><span style=color:#f92672>&gt;</span> <span style=color:#111>t</span><span style=color:#111>;</span>
    <span style=color:#111>fenwick</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>n_</span><span style=color:#111>)</span><span style=color:#f92672>:</span><span style=color:#111>n</span><span style=color:#111>(</span><span style=color:#111>n_</span><span style=color:#111>),</span><span style=color:#111>t</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>){}</span>
    <span style=color:#00a8c8>void</span> <span style=color:#75af00>update</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#00a8c8>int</span> <span style=color:#111>x</span><span style=color:#111>){</span>
        <span style=color:#00a8c8>for</span><span style=color:#111>(;</span><span style=color:#111>i</span><span style=color:#f92672>&lt;=</span><span style=color:#111>n</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>+=</span><span style=color:#111>i</span><span style=color:#f92672>&amp;-</span><span style=color:#111>i</span><span style=color:#111>){</span>
            <span style=color:#111>t</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>+=</span><span style=color:#111>x</span><span style=color:#111>;</span>
        <span style=color:#111>}</span>
    <span style=color:#111>}</span>
    <span style=color:#111>ll</span> <span style=color:#75af00>query</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>){</span>
        <span style=color:#111>ll</span> <span style=color:#111>res</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span>
        <span style=color:#00a8c8>for</span><span style=color:#111>(;</span><span style=color:#111>i</span><span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span><span style=color:#111>i</span><span style=color:#f92672>-=</span><span style=color:#111>i</span><span style=color:#f92672>&amp;-</span><span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>res</span><span style=color:#f92672>+=</span><span style=color:#111>t</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>res</span><span style=color:#111>;</span>
    <span style=color:#111>}</span>
<span style=color:#111>};</span>
<span style=color:#00a8c8>int</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
    <span style=color:#111>ios</span><span style=color:#f92672>::</span><span style=color:#111>sync_with_stdio</span><span style=color:#111>(</span><span style=color:#111>false</span><span style=color:#111>);</span>
    <span style=color:#111>cin</span><span style=color:#111>.</span><span style=color:#111>tie</span><span style=color:#111>(</span><span style=color:#00a8c8>nullptr</span><span style=color:#111>);</span>
    <span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>;</span>
    <span style=color:#111>cin</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>n</span><span style=color:#111>;</span>
    <span style=color:#111>vector</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>a</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>),</span><span style=color:#111>idx</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>);</span>
    <span style=color:#111>for1</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>){</span>
        <span style=color:#111>cin</span><span style=color:#f92672>&gt;&gt;</span><span style=color:#111>a</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
        <span style=color:#111>idx</span><span style=color:#111>[</span><span style=color:#111>a</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]]</span><span style=color:#f92672>=</span><span style=color:#111>i</span><span style=color:#111>;</span>
    <span style=color:#111>}</span>
    <span style=color:#111>fenwick</span> <span style=color:#111>sum</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>);</span>
    <span style=color:#111>ordered_set</span><span style=color:#f92672>&lt;</span><span style=color:#00a8c8>int</span><span style=color:#f92672>&gt;</span> <span style=color:#111>st</span><span style=color:#111>;</span>
    <span style=color:#111>ll</span> <span style=color:#111>inv</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span><span style=color:#111>;</span>
    <span style=color:#111>for1</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>){</span>
        <span style=color:#00a8c8>int</span> <span style=color:#111>p</span><span style=color:#f92672>=</span><span style=color:#111>idx</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
        <span style=color:#111>inv</span><span style=color:#f92672>+=</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#111>st</span><span style=color:#111>.</span><span style=color:#111>order_of_key</span><span style=color:#111>(</span><span style=color:#111>p</span><span style=color:#111>);</span>
        <span style=color:#111>st</span><span style=color:#111>.</span><span style=color:#111>insert</span><span style=color:#111>(</span><span style=color:#111>p</span><span style=color:#111>);</span>
        <span style=color:#111>ll</span> <span style=color:#111>mid_pos</span><span style=color:#f92672>=*</span><span style=color:#111>st</span><span style=color:#111>.</span><span style=color:#111>find_by_order</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#111>);</span>
        <span style=color:#111>sum</span><span style=color:#111>.</span><span style=color:#111>update</span><span style=color:#111>(</span><span style=color:#111>p</span><span style=color:#111>,</span><span style=color:#111>p</span><span style=color:#111>);</span>
        <span style=color:#111>ll</span> <span style=color:#111>front</span><span style=color:#f92672>=</span><span style=color:#111>i</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#111>,</span><span style=color:#111>back</span><span style=color:#f92672>=</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#111>front</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>;</span>
        <span style=color:#111>ll</span> <span style=color:#111>front_sum</span><span style=color:#f92672>=</span><span style=color:#111>sum</span><span style=color:#111>.</span><span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>mid_pos</span><span style=color:#111>);</span>
        <span style=color:#111>ll</span> <span style=color:#111>back_sum</span><span style=color:#f92672>=</span><span style=color:#111>sum</span><span style=color:#111>.</span><span style=color:#111>query</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>front_sum</span><span style=color:#111>;</span>
        <span style=color:#111>cout</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#111>inv</span><span style=color:#f92672>+</span><span style=color:#111>mid_pos</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>front</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>front_sum</span><span style=color:#f92672>+</span><span style=color:#111>back_sum</span><span style=color:#f92672>-</span><span style=color:#111>mid_pos</span><span style=color:#f92672>*</span><span style=color:#111>back</span><span style=color:#f92672>-</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#111>front</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>front</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#f92672>-</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#111>back</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>back</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#d88200>&#39; &#39;</span><span style=color:#111>;</span>
    <span style=color:#111>}</span>
    <span style=color:#00a8c8>return</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
<span style=color:#111>}</span>
</code></pre></div><div class=blog-tags><a href=https://blog.tgc-thallium.com/tags/data-structure/>Data Structure</a>&nbsp;
<a href=https://blog.tgc-thallium.com/tags/fenwick-tree/>Fenwick Tree</a>&nbsp;</div></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><div id=gitalk-container></div><script>var gitalk=new Gitalk({clientID:'804f53fd87621403bf11',clientSecret:'5cfea89eac0c032eb02b333a1030d73e7b6e2176',repo:'blog',owner:'thallium',admin:['thallium'],id:location.pathname,distractionFreeMode:!1});gitalk.render('gitalk-container')</script></div><footer><div class=social-icons><a href=https://github.com/thallium name=GitHub><em class="fab fa-github"></em></a></div><div class=container><p class="credits copyright"><a href=https://blog.tgc-thallium.com/about>Gengchen</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.tgc-thallium.com/>Thallium's Blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>